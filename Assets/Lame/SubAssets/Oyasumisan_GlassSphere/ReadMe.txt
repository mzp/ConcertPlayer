ガラス球向けガラスシェーダー
Ver.1.1
お休みさん(twitter:@0yasum13)



＜ライセンス＞
パブリックドメイン(CC0)とします。
ご自由にお使いください。



＜インストール＞
Unityプロジェクトを開き、適当なフォルダにshaderファイル及びTexturesフォルダ内のPNGファイルをドラッグ&ドロップしてください。
アップデートの場合はUnity上で元のシェーダを削除してからコピーするか、エクスプローラにて直接上書きコピーしてください。



＜使い方＞
まず任意のマテリアルにて、シェーダー「Shader Forge/oy_GlassSphere(VRCSafety:Particle)」または
「Shader Forge/oy_GlassSphere_Forward(VRCSafety:Particle)」を選択してください。
(違いは後述)
次にMatcapのテクスチャ欄に、Texturesフォルダ内に同梱している「matcap_horizon_gradation.png」をセットします。
他のパラメータはデフォルトの設定でまずは試してみてください。
(同梱の「デフォルト設定.png」に書かれている値がデフォルトです。)


◆ShaderForgeで作成しているため、ShaderForgeを導入している環境であればノードベースでの編集ができます。これを踏み台にして自由にシェーダを作ってみてください。

なお、VRChatにてこのシェーダを使用した際、他プレイヤーのセーフティ設定によりシェーダを無効化された場合には、白色半透明のシェーダ(Particles)としてふるまいます。
色や透過率などの変更は現時点ではできないようです。



＜設定項目＞
以下のパラメータを調整して、好みのガラス感を出してみてください。

Use Distortion:
Distortion（縁のゆがみ）の使用をオンオフできます。

Distortion:
ガラスを通して見えるもののゆがみ度合いを調整できます。
小さな値にするとゆがみ効果が大きくなり、大きな値にするとゆがみ効果はなくなります。
実際のガラスとは違う効果ですが、適度な値にすることでガラスらしさを表現できるかもしれません。
設定したら、モデルを斜めや横から見てみてください。

Specular:
表面での反射度合いを調整できます。
リアルタイムライト及びReflection Probeによる反射度合いになります。

Gloss:
こちらも表面での反射度合いですが、Specularと効果のかかり方が違います。
大きな値にすると、映り込みが鏡面のようにくっきりします。
こちらもリアルタイムライト及びReflection Probeによる反射度合いになります。

Albedo_Base_Color:
ガラスのベースの色味を変更します。

Glass_Color:
ガラスのベースの色味を変更します。(Albedo_Base_Colorでも変更できますが、こちらを変えると少し暗くもできます)

Incident_Color:
ガラス自体とは別に、入射光に対しての色味付けや明るさの強弱を調整できます。

Reflection_Color:
反射光全体(Specular,Matcap)に対しての色味付けや明るさの強弱を調整できます。

Emission_Base_Color:
暗いワールドなどで、周囲の明るさや傾きによらず常に一定の色で光らせたい場合に設定します。
通常は黒のままで良いです。

Matcap:
Matcapとして使用する画像をセットします。
Matcapにより、ワールドのライトやReflection Probeによらず、光を反射しているように見せることができます。

Matcap Style:
Matcap効果の現れ方を切り替えます。
オフの場合:Matcapテクスチャの反映がワールド基準になり、疑似的なReflection Probeのような感じになります。
添付している「matcap_horizon_gradation.png」ではオフ推奨です。
オンの場合:Matcapテクスチャの反映がビュー基準になり、一般的なMatcapっぽい挙動になります。

Matcap_Scale:
Matcapによる反射光のサイズを変更します。小さくすると広範囲にわたって反射しているように見えます。
大きなオブジェクトに適用する場合にこの値を小さくするなど試してみてください。

Matcap_Strength:
Matcapによる反射の強さを設定します。
反射光全体の明るさはReflection_Colorで変更できますが、こちらはそれに加えてMatcapのみを調整するものです。
(Matcapによる反射はEmissionで実現しているため、好みに応じて強弱をつけられるようにしました。)

Matcap_Hue_Range:
Matcapによる反射に対する、色相変化効果の強弱を調整できます。
Matcapにはメガネレンズのコーティングをイメージして、視点からの位置関係で色相が変化する効果を追加してあります。0にすると色相は変化しません。

Matcap_Emission_Bottom: 
Matcapによる反射では、ワールドの明るさに応じたMatcapの明るさ調整を行っています。
この明るさ調整の下限値を調整できます。

Normal Map:
必要であればノーマルマップを指定できます。例えば型ガラス風にしたり、表面に水滴がついているかのような効果を付加したりができるかもしれません。

Texture:
ガラスに適用するテクスチャを指定します。
アルファ値に対応しています。
また、テクスチャの描画はDistortionの影響を受けます。

Texture Opacity:
テクスチャ全体の透過率を指定します。
0で不透明、1で完全に透明となります。

※ダミーパラメータ
Color
このパラメータはVRChatにてセーフティ設定によりシェーダを無効化された際、半透明のシェーダとしてふるまうために必要なパラメータであり、変更不要です。
このパラメータを変更することによる見た目の変化はないようです。



＜おまけ1＞
このシェーダーはFrontface Culling（メッシュの裏面に描画し、表面は非表示）ですが、
逆のBackface Culling（メッシュの表面に描画し、裏面は非表示）に設定しただけのシェーダー「oy_GlassSphere_Forward.shader」も同梱してあります。
特徴は以下のような感じです。

「oy_GlassSphere.shader」
・内側に入った物に球の反射光が被らない
・内側に入った物がゆがまない(ゆがむ場合は、その物の背面側に描画される)
・Distortion値をある程度大きくしてもガラス玉っぽさがある ※私見
・(多分)大きなものを入れるには向かない ※私見
・アバターなど歪ませたくないものを入れる場合向き

「oy_GlassSphere_Forward.shader」
・内側に入った物に球の反射光が被る
・内側に入った物がゆがむ
・Distortionを小さくするととてもガラス玉っぽい ※私見
・無機物などゆがませても問題ないものを入れる場合向き

好みや用途に応じて好きなほうをお使いください。



＜おまけ2＞
「oy_GlassSphere.shader」を使用する際には球の表面にあたる部分の反射は再現できないため、
同じ形のメッシュ(オブジェクト)を同じ位置、サイズでもう一つ重ねて使用することを想定した透明のMatcapシェーダーを2種類同梱しています。
いずれも背景を透過し、Matcapのテクスチャだけを重ねるシェーダーです。
各パラメータは「oy_GlassSphere.shader」に準じます。

「oy_Matcap.shader」
こちらはワールドの明るさに応じたMatcapの明るさ調整が可能になっています。

「oy_MatcapSimple.shader」
こちらはMatcapの明るさは周囲によらず固定で、Matcap_Strengthのみ調整可能です。
明るさ調整が不要であればこちらのほうが軽量です。

いずれのシェーダーを使う際も、Render Queueを「oy_GlassSphere.shader」を使っているマテリアル側で指定している値より1以上高い値に設定してください。
設定例は「Matcapシェーダー設定例.PNG」にあります。
また、Matcapテクスチャの例としてTexturesフォルダ内に「Matcap_01.png」を同梱しています。



＜更新履歴＞
Ver 1.1 2019.06.15
oy_GlassSphere_Forward.shaderについて、シェーダの名称がoy_GlassSphere.shaderと同じになっていたため、Unity上で共存できなかったのを修正
(シェーダ名を"Shader Forge/oy_GlassSphere_Forward(VRCSafety:Particle)"に変更)

Ver 1.0 2018.12.01
公開

Ver 0.2 2018.11.30
テクスチャに対応。
Matcap Style=ONの場合の処理が意図と異なっていたのを修正。
表面向けMatcapシェーダーを同梱。

Ver 0.1 2018.11.29
テスト公開